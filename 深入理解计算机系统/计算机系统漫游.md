# 1、计算机系统漫游
计算机系统是由硬件和系统软件组成的。



## 1.1、信息就是位+上下文

源程序：hello.c

```c
#include <stdio.h>

int main(){
	printf("hello, world\n");
	return 0;
}
```

源程序，一个由值0和1组成的位/比特序列，8个位组成一组，称为字节，每个字节表示程序中的文本字符。

计算机系统使用ASII标准表示文本字符，用一个唯一的单字节大小的整数值来表示每个字符。

只由ASCII字符构成的文件称为文本文件，所有其他文件称为二进制文件。

系统中所有的信息，包括磁盘文件、内存中的程序、内存中存放的用户数据以及网络上传送的数据，都是由一串比特表示的。

区分不同数据对象的唯一方法是读取数据对象时候的上下文，在不同的上下文中，一个同样的字节序列可能表示一个整数、浮点数、字符串或者机器指令。

数字的机器表示方式，与实际的整数和实数是不同的，是对真值的有限近似值，有时候会有意想不到的行为表现。


## 1.2、程序被其他程序翻译成不同的格式

每条C语句都必须被其他程序转化为一系列的低级机器语言指令，才能在系统上运行。

这些指令按照一种称为可执行目标程序/文件的格式打好包，并以二进制磁盘文件的形式存放起来。

在Unix系统上，从源程序到目标文件的转化/翻译是由编译器驱动程序完成的，例如GCC。

```
//终端命令，直接在Mac终端运行
gcc -o hello hello.c
```

编译系统由预处理器、编译器、汇编器和链接器构成。

|阶段|执行程序|输入|输出|
|----|----|----|----|
|预处理阶段|预处理器 cpp|源程序文本 hello.c|源程序文本 hello.i|
|编译阶段|编译器 ccl|源程序文本 hello.i|汇编程序文本 hello.s|
|汇编阶段|汇编器 as|汇编程序文本 hello.s|二进制的可重定位目标程序 hello.o|
|链接阶段|链接器 ld|二进制的可重定位目标程序 hello.o + 其他预编译好的目标文件 例如printf.o|二进制的可执行目标程序 hello|

### 1.2.1、预处理阶段
预处理器根据以字符#开头的命令，修改原始的C程序，得到另一个C程序。

例如读取系统头文件的内容，并插入程序文本中。
```
#include <stdio.h>
```

### 1.2.2、编译阶段
编译器将源程序翻译成汇编语言程序。

汇编语言程序的每条语句，都以文本格式描述低级机器语言指令。

汇编语言为不同高级语言的不同编译器，提供了通用的输出语言。

### 1.2.3、汇编阶段
可重定位目标程序 relocatable object program

汇编器将汇编语言程序翻译成机器语言指令，并打包成可重定位目标程序的格式，将结果保存在目标文件中。

### 1.2.4、链接阶段

链接器合并预编译好的目标文件，得到可执行目标文件/程序，可以被加载到内存中，由系统执行。



## 1.3、了解编译系统如何工作是大有益处的
优化程序性能。
理解链接时出现的错误。
避免安全漏洞。

## 1.4、处理器读并解释储存在内存中的指令
在Unix系统上，运行存储在磁盘上的、由编译系统从源程序翻译而成的可执行目标文件：
```
//终端命令，直接在Mac终端运行
./hello
hello, world
```
命令行解释器将加载并运行可执行文件，然后等待程序终止。

### 1.4.1、系统的硬件组成

#### 总线
总线是贯穿整个系统的一组电子管道，携带信息字节并负责在各个部件间传递。

#### IO设备
IO设备是系统与外部世界的联系通道。例如键盘、鼠标、显示器、磁盘驱动器。
每个IO设备都通过一个控制器或适配器与IO总线相连。
控制器是IO设备本身或者系统的主印制电路板。
适配器是一块插在主板插槽上的卡。

#### 主存
主存是一个临时存储设备，在处理器执行程序时，用来存放程序和程序处理的数据。
从物理上说，主存是由一组动态随机存取存储器DRAM芯片组成的。
从逻辑上说，存储器是一个线性的字节数组，每个字节都有其唯一的地址/数组索引，这些地址是从零开始的。

#### 处理器
中央处理单元CPU，简称处理器，是解释或执行存储在主存中指令的引擎。
处理器的核心是一个大小为一个字节的存储设备或寄存器，称为程序计数器PC。
在任何时候，PC都指向主存中的某条机器语言指令，也就是含有该条指令的地址。
从系统通电开始，直到系统断电，处理器一直在不断地执行程序计数器指向的指令，再更新程序计数器，使其指向下一条指令。


